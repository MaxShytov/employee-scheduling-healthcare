{# templates/core/components/filter_bar.html #}
{% load i18n %}

{% comment %}
Universal filter bar component.

Props:
  - filters: list[dict] - list of filter configs from FilterSet.to_template_context()
  - action_url: str - form action URL (usually request.path)
  - method: str - 'get' (default)
{% endcomment %}

{% if filters %}
<div class="filter-bar mb-4">
  <form method="{{ method|default:'get' }}" action="{{ action_url }}" class="filter-form">
    <div class="d-flex flex-wrap gap-3 align-items-end">
      {% comment %} English: Filter fields in horizontal row {% endcomment %}
      {% for filter in filters %}
        {% if filter.type == 'text' %}
          <div class="filter-field" style="min-width: 200px;">
            <label for="id_{{ filter.name }}" class="form-label small text-muted mb-1">{{ filter.label }}</label>
            <input 
              type="text" 
              id="id_{{ filter.name }}" 
              name="{{ filter.name }}" 
              value="{{ filter.value }}" 
              placeholder="{{ filter.placeholder }}" 
              class="form-control form-control-sm">
            {% if filter.help_text %}<small class="form-text text-muted">{{ filter.help_text }}</small>{% endif %}
          </div>

        {% elif filter.type == 'select' %}
          <div class="filter-field" style="min-width: 180px;">
            <label for="id_{{ filter.name }}" class="form-label small text-muted mb-1">{{ filter.label }}</label>
            <select id="id_{{ filter.name }}" name="{{ filter.name }}" class="form-select form-select-sm">
              {% for option in filter.options %}
                <option value="{{ option.value }}" {% if option.value == filter.value %}selected{% endif %}>
                  {{ option.label }}
                </option>
              {% endfor %}
            </select>
            {% if filter.help_text %}<small class="form-text text-muted">{{ filter.help_text }}</small>{% endif %}
          </div>

        {% elif filter.type == 'checkbox' %}
          <div class="filter-field d-flex align-items-center">
            {% comment %} English: Checkbox styled as success button (green when checked) {% endcomment %}
            <input 
              type="checkbox" 
              id="id_{{ filter.name }}" 
              name="{{ filter.name }}" 
              value="true" 
              {% if filter.checked %}checked{% endif %} 
              class="btn-check"
              autocomplete="off">
            <label 
              for="id_{{ filter.name }}" 
              class="btn btn-sm btn-outline-success d-flex align-items-center gap-1">
              {% if filter.checked %}
                <span class="material-icons" style="font-size: 16px;">check</span>
              {% endif %}
              <span>{{ filter.label }}</span>
            </label>
            {% if filter.help_text %}<small class="form-text text-muted d-block mt-1">{{ filter.help_text }}</small>{% endif %}
          </div>

        {% elif filter.type == 'date' %}
          <div class="filter-field" style="min-width: 160px;">
            <label for="id_{{ filter.name }}" class="form-label small text-muted mb-1">{{ filter.label }}</label>
            <input 
              type="date" 
              id="id_{{ filter.name }}" 
              name="{{ filter.name }}" 
              value="{{ filter.value }}" 
              class="form-control form-control-sm">
            {% if filter.help_text %}<small class="form-text text-muted">{{ filter.help_text }}</small>{% endif %}
          </div>

        {% elif filter.type == 'number' %}
          <div class="filter-field" style="min-width: 140px;">
            <label for="id_{{ filter.name }}" class="form-label small text-muted mb-1">{{ filter.label }}</label>
            <input 
              type="number" 
              id="id_{{ filter.name }}" 
              name="{{ filter.name }}" 
              value="{{ filter.value }}" 
              {% if filter.min %}min="{{ filter.min }}"{% endif %} 
              {% if filter.max %}max="{{ filter.max }}"{% endif %} 
              class="form-control form-control-sm">
            {% if filter.help_text %}<small class="form-text text-muted">{{ filter.help_text }}</small>{% endif %}
          </div>
        {% endif %}
      {% endfor %}

      {% comment %} English: Action buttons as button group (merged appearance) {% endcomment %}
      <div class="filter-actions">
        {% comment %} English: Empty label for alignment {% endcomment %}
        <label class="form-label small text-muted mb-1 d-block">&nbsp;</label>
        
        <div class="btn-group btn-group-sm" role="group">
          <button type="submit" class="btn btn-primary d-flex align-items-center gap-1">
            <span class="material-icons" style="font-size: 16px;">filter_list</span>
            <span>{% trans "Apply" %}</span>
          </button>
          <a href="{{ action_url }}" class="btn btn-outline-secondary d-flex align-items-center gap-1">
            <span class="material-icons" style="font-size: 16px;">clear</span>
            <span>{% trans "Clear" %}</span>
          </a>
        </div>
      </div>
    </div>
  </form>
</div>

<style>
  /* MD3 Filter Chip behavior */
  .btn-check:checked + .btn-outline-primary {
    background-color: var(--bs-primary);
    border-color: var(--bs-primary);
    color: white;
  }
  
  .btn-check:checked + .btn-outline-primary:hover {
    background-color: var(--bs-primary);
    border-color: var(--bs-primary);
    opacity: 0.9;
  }
  
  /* Smooth transition */
  .btn-outline-primary {
    transition: all 0.2s ease-in-out;
  }
</style>
{% endif %}