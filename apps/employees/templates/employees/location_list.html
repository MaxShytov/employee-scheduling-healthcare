{% extends 'core/layouts/list_page.html' %}
{% load i18n %}
{% load ui_components %}

{% block page_title %}{% trans "Locations" %}{% endblock %}
{% block page_subtitle %}{% trans "Manage clinic and office locations" %}{% endblock %}

{% block page_actions %}
<a href="{% url 'employees:location_create' %}" class="btn btn-primary">
    <span class="material-icons" style="font-size: 16px; vertical-align: middle;">add</span>
    {% trans "Add Location" %}
</a>
{% endblock %}

{% block stats %}
<div class="row mb-4">
    <div class="col-md-4">
        {% stat_card title='Total Locations' value=total_locations icon='business' color='primary' %}
    </div>
</div>
{% endblock %}

{% block filters %}
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-5">
                {{ search_form.search }}
            </div>
            <div class="col-md-3">
                {{ search_form.country }}
            </div>
            <div class="col-md-2">
                {{ search_form.is_active }}
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-outline-primary w-100">
                    <span class="material-icons" style="font-size: 16px; vertical-align: middle;">search</span>
                    {% trans "Search" %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block table_content %}
{% if page_obj %}
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>{% trans "Name" %}</th>
                    <th>{% trans "City" %}</th>
                    <th>{% trans "Country" %}</th>
                    <th>{% trans "Manager" %}</th>
                    <th class="text-center">{% trans "Employees" %}</th>
                    <th class="text-center">{% trans "Status" %}</th>
                    <th class="text-end">{% trans "Actions" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for location in page_obj %}
                <tr>
                    <td>
                        <strong>{{ location.name }}</strong><br>
                        <small class="text-muted">{{ location.address }}</small>
                    </td>
                    <td>{{ location.city }}</td>
                    <td>
                        {% if location.country == 'CA' %}
                            {% icon 'flag' size=18 %} {% trans "Canada" %}
                        {% elif location.country == 'CH' %}
                            {% icon 'flag' size=18 %} {% trans "Switzerland" %}
                        {% endif %}
                    </td>
                    <td>
                        {% if location.manager %}
                            {{ location.manager.get_full_name }}
                        {% else %}
                            <span class="text-muted">â€”</span>
                        {% endif %}
                    </td>
                    <td class="text-center">
                        {% badge location.emp_count color='primary' pill=True %}
                    </td>
                    <td class="text-center">
                        {% status_badge location.is_active %}
                    </td>
                    <td class="text-end">
                        {% action_buttons obj=location %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    {% empty_state 
        icon='business' 
        title='No locations found' 
        message='Create your first clinic location to get started'
        button_text='Add Location'
        button_url=create_url
    %}
{% endif %}
{% endblock %}